{% extends 'base.html' %}

{% block title %}Play - YCulture{% endblock %}

{% block content %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'play/css/play.css' %}">
    <script src="{% static 'play/js/script.js' %}"></script>
   



    <div id="questions">
        <div class="question">
            <h2>Question :</h2>
            <div id="timer"><span id="countdown"></span></div>

            <p>{{ question.0 }}</p>

            <form id="response-form" method="post" action="{% url 'play' %}">
                {% csrf_token %}
                <div id="response">
                    <ul>
                        <li>
                            <button type="submit" class="response-button" name="selected_answer_id" value="{{ response.0.0.id }}">{{ response.0.0 }}</button>
                        </li>
                        <li>
                            <button type="submit" class="response-button" name="selected_answer_id" value="{{ response.0.1.id }}">{{ response.0.1 }}</button>
                        </li>
                        <li>
                            <button type="submit" class="response-button" name="selected_answer_id" value="{{ response.0.2.id }}">{{ response.0.2 }}</button>
                        </li>
                        <li>
                            <button type="submit" class="response-button" name="selected_answer_id" value="{{ response.0.3.id }}">{{ response.0.3 }}</button>
                        </li>
                    </ul>
                </div>
            </form>
        </div>
    </div>






    <div class="game">
        <div id="questions">
            <h2>Combien de temps faut-il à la Terre pour effectuer une révolution autour du soleil ?{{ value }}</h2>
            <div id="timer"><span id="countdown"></span></div>
            <form action="/submit_answer" method="post" role="form" aria-label="Sélectionner une durée en jours">
                <ul class="button-list">
                    <li><button type="submit" name="answer" value="365 jours" role="button" aria-label="365 jours">365 jours</button></li>
                    <li><button type="submit" name="answer" value="365.25 jours" role="button" aria-label="365.25 jours">365.25 jours</button></li>
                    <li><button type="submit" name="answer" value="365.5 jours" role="button" aria-label="365.5 jours">365.5 jours</button></li>
                    <li><button type="submit" name="answer" value="366 jours" role="button" aria-label="366 jours">366 jours</button></li>
                </ul>
            </form>
        </div>
    </div>


    <script>
        function updateTimer(){
    let countdownElement = document.getElementById("countdown")
    let seconds = 30
    function countdown(){
        seconds--
        let minutes = Math.floor(seconds / 60)
        let remainingSeconds = seconds % 60
        countdownElement.textContent = minutes + ":" + (remainingSeconds < 10 ? "0" : "") + remainingSeconds
        if(seconds <= 0){
            console.log("la")
            clearInterval(timer)
            countdownElement.textContent = "0:00"
            window.location.reload();

        }
    }
    countdown()
    let timer = setInterval(countdown, 1000)
}

        function handleResponseButtonClick() {
        var buttons = document.querySelectorAll('.response-button');
        buttons.forEach(function(button) {
            button.addEventListener('click', function(event) {
                event.preventDefault(); 
                var selectedAnswer = button.value;
                console.log('Selected answer:', selectedAnswer);

                var formData = new FormData();
                formData.append('selected_answer', selectedAnswer);
                
                fetch('/play/', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        console.log('Réponse enregistrée avec succès');
                        // Actualiser la page après avoir envoyé la réponse
                        location.reload();
                    } else {
                        console.error('Erreur lors de l\'enregistrement de la réponse');
                    }
                })
                .catch(error => {
                    console.error('Erreur lors de l\'envoi des données:', error);
                });
            });
        });
    }
    updateTimer()
    handleResponseButtonClick();
    </script>
{% endblock %}
